<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruang Chat</title>
    <style>
        /* Identik dengan CSS di atas */
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">Ruang Chat</div>
        <div class="chat-messages"></div>
        <div class="chat-input">
            <input type="text" placeholder="Ketik pesan Anda..." />
            <button onclick="sendMessage()">Kirim</button>
        </div>
    </div>

    <script>
        const messages = document.querySelector('.chat-messages');
        const socket = new WebSocket('ws://localhost:8080');

        socket.addEventListener('open', (event) => {
            console.log('Koneksi WebSocket terbuka:', event);
            socket.send(JSON.stringify({
                type: 'getPreviousMessages'
            }));
        });

        socket.addEventListener('message', (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'previousMessages') {
                data.messages.forEach(message => {
                    displayMessage(message);
                });
            } else if (data.type === 'newMessage') {
                displayMessage(data.message);
            }
        });

        function sendMessage() {
            const inputField = document.querySelector('.chat-input input');
            const userMessage = inputField.value;
            if (userMessage.trim() !== "") {
                const messageData = {
                    user: 'User', // Ganti dengan nama pengguna yang sesuai
                    text: userMessage,
                    profilePic: 'https://via.placeholder.com/40' // Ganti dengan URL foto profil yang sesuai
                };
                socket.send(JSON.stringify({
                    type: 'sendMessage',
                    message: messageData
                }));
                inputField.value = ''; // Kosongkan input setelah mengirim
            }
        }

        function displayMessage(message) {
            const messages = document.querySelector('.chat-messages');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.innerHTML = `
                <img src="${message.profilePic}" alt="Profile Picture">
                <div class="message-content">
                    <strong>${message.user}:</strong> ${message.text}
                </div>`;
            messages.appendChild(messageElement);
            messages.scrollTop = messages.scrollHeight; // Scroll ke bawah saat pesan baru diterima
        }
    </script>
</body>
</html>
